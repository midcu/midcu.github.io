(self.webpackChunkva_auth_main=self.webpackChunkva_auth_main||[]).push([[256],{6372:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("va-main-content",[i("div",{staticClass:"va-main-content-header"},[i("el-input",{staticClass:"va-system-bt-search",attrs:{size:"small",clearable:"",placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search()}},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}}),e._v(" "),i("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-search"},on:{click:function(t){return e.search()}}},[e._v("搜索")]),e._v(" "),i("div",{staticStyle:{flex:"1"}}),e._v(" "),i("div",[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["roles:add"],expression:"['roles:add']"}],attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新增")])],1)],1),e._v(" "),i("el-row",[i("el-col",{staticStyle:{"padding-left":"5px",background:"#fff","padding-bottom":"20px"},attrs:{xs:24,sm:24,md:16,lg:16,xl:17}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"va-table-thead-theme",attrs:{data:e.data}},[i("el-table-column",{attrs:{prop:"name",width:"180px",label:"名称"}}),e._v(" "),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"description",label:"描述"}}),e._v(" "),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,width:"180px",prop:"createTime",label:"创建日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e._f("vaParseTime")(t.row.createTime)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"220px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["roles:menus"],expression:"['roles:menus']"}],attrs:{icon:"el-icon-s-order",size:"mini",type:"text"},on:{click:function(i){return e.getRoleMenus(t.row)}}},[e._v("\n                            菜单\n                        ")]),e._v(" "),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["roles:edit"],expression:"['roles:edit']"}],staticStyle:{"margin-left":"0"},attrs:{icon:"el-icon-edit",size:"mini",type:"text"},on:{click:function(i){return e.edit(t.row)}}},[e._v("\n                            编辑\n                        ")]),e._v(" "),i("el-popconfirm",{directives:[{name:"permission",rawName:"v-permission",value:["roles:del"],expression:"['roles:del']"}],attrs:{title:"确定永久删除该角色吗？"},on:{confirm:function(i){return e.remove(t.row)}}},[i("el-button",{attrs:{slot:"reference",type:"text",icon:"el-icon-delete",size:"mini"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),i("br"),e._v(" "),i("el-pagination",{staticStyle:{"text-align":"center"},attrs:{background:"","current-page":e.page,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.sizeChange,"current-change":e.pageChange}})],1),e._v(" "),i("el-col",{attrs:{xs:24,sm:24,md:8,lg:8,xl:7}},[i("el-card",{staticStyle:{"margin-left":"15px"},attrs:{shadow:"never"}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[e._v("菜单分配"),i("span",{staticStyle:{color:"#67C23A"}},[e._v("（"+e._s(e.currectRole.name)+"）")])]),e._v(" "),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["roles:menus"],expression:"['roles:menus']"}],staticStyle:{float:"right",padding:"3px 0"},attrs:{icon:"el-icon-check",size:"small",type:"text"},on:{click:e.saveMenu}},[e._v("\n                        保存\n                    ")])],1),e._v(" "),i("el-tree",{ref:"menu",attrs:{data:e.menus,"default-checked-keys":e.menuIds,props:e.defaultProps,"check-strictly":"",accordion:"","show-checkbox":"","node-key":"id"}})],1)],1)],1),e._v(" "),i("el-dialog",{attrs:{"custom-class":"va-dialog-submit",visible:e.submitFormDialog,width:"580px",title:"角色","close-on-click-modal":!1},on:{"update:visible":function(t){e.submitFormDialog=t},close:e.cancel}},[i("el-form",{ref:"submitForm",attrs:{model:e.submitForm,rules:e.rules,size:"small","label-width":"80px"}},[i("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.submitForm.name,callback:function(t){e.$set(e.submitForm,"name",t)},expression:"submitForm.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色描述",prop:"description"}},[i("el-input",{attrs:{type:"textarea",rows:3,maxlength:"128","show-word-limit":"",placeholder:"请输入角色描述"},model:{value:e.submitForm.description,callback:function(t){e.$set(e.submitForm,"description",t)},expression:"submitForm.description"}})],1),e._v(" "),i("el-form-item",{staticStyle:{"text-align":"right"}},[i("el-button",{on:{click:function(t){e.submitFormDialog=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("保存")])],1)],1)],1)],1)};s._withStripped=!0;var a=i(3633);const n={name:"va-roles",data:function(){return{searchKey:"",total:1,page:1,pageSize:10,loading:!1,showButton:!0,menus:[],menuIds:[],defaultProps:{children:"children",label:"title"},submitFormDialog:!1,submitForm:{name:"",description:""},data:[],currectRole:{name:"未选中角色"},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}}},mounted:function(){this.search(),this.getMenus()},methods:{search:function(e){var t=this;this.loading=!0,this.$authApi.GetAllRoles({searchKey:this.searchKey,page:e||1,pageSize:this.pageSize}).then((function(e){t.data=e.list,t.total=e.total,t.loading=!1})).catch((function(){t.loading=!1}))},getMenus:function(){var e=this;this.$authApi.GetAllMenus().then((function(t){e.menus=(0,a.e9)(t)}))},add:function(){this.submitForm={id:"",name:"",description:""},this.submitFormDialog=!0},edit:function(e){this.submitForm={id:e.id,name:e.name,description:e.description},this.submitFormDialog=!0},cancel:function(){this.submitFormDialog=!1,this.$refs.submitForm.clearValidate()},submit:function(){var e=this;this.$refs.submitForm.validate((function(t){t&&(e.submitForm.id?e.$authApi.EditRole({id:e.submitForm.id,name:e.submitForm.name,description:e.submitForm.description}).then((function(t){e.$message.success("操作成功"),e.submitFormDialog=!1,e.search()})):e.$authApi.AddRole({name:e.submitForm.name,description:e.submitForm.description}).then((function(t){e.$message.success("操作成功"),e.submitFormDialog=!1,e.search()})))}))},saveMenu:function(){var e=this;if(this.currectRole.id){var t=[];this.$refs.menu.getCheckedNodes().forEach((function(e,i){t.push(e.id)})),this.$authApi.ResetRoleMenus({id:this.currectRole.id,roleIds:t}).then((function(){e.$message.success("操作成功")}))}else this.$message.warning("未选中角色")},remove:function(e){var t=this;this.$authApi.DelRole({id:e.id}).then((function(){t.$message({type:"success",message:"删除成功!"}),t.search()}))},getRoleMenus:function(e){var t=this;this.currectRole=e,this.$refs.menu.setCheckedKeys([]),this.$authApi.GetRoleMenuIds({id:e.id}).then((function(e){Array.isArray(e)?t.menuIds=e:t.menuIds=[]}))},sizeChange:function(e){this.pageSize=e,this.search()},pageChange:function(e){this.search(e)}}};var o=(0,i(1900).Z)(n,s,[],!1,null,null,null);o.options.__file="src/auth/views/system/roles.vue";const r=o.exports}}]);